<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <title>景点门票</title>
    <link rel="stylesheet" href="/statics/wap/css/comm.css" />
    <link rel="stylesheet" href="/statics/wap/css/index.css" />
    <link rel="stylesheet" href="/statics/wap/css/swiper.min.css" />
</head>
<body class="wap-bg-1">

<header class="wap-bg-5 wap-pst-r" id="listheader">
    <h3 class="wap-fnts-2">景点门票</h3>
    <a href="#" class="list-top-a1"  id="check"><img src="/statics/wap/images/fkico.png" /></a>
    <a href="/" class="list-top-a2"><img src="/statics/wap/images/jtico.png"  /></a>
</header>
<div id="listnavbox" style="display: none;">
    <div class="navlist1 wap-bg-2 wap-pad-1">
        <ul class="listnav">
            <li class="index "><a href="/">首页</a></li>
            <li class="around "><a href="/m/around">周边游</a></li>
            <li class="inbound "><a href="/m/inbound">国内游</a></li>
            <li class="outbound "><a href="/m/outbound">境外游</a></li>
            <li class="ticket "><a href="/m/ticket">主题游</a></li>
            <li class="local "><a href="/m/local">本地游玩</a></li>
        </ul>
        <h3 class="wap-fnts-1">出发地</h3>
        <div id="brand">
            <ul class="listnav">
                <li class="gree"><a href="#">不限</a> </li>
                {{if !empty($system)}}
                {{foreach $system as $key=>$value}}
                {{if $value['system_class']==1}}
                <li ast="{{$value['system_id']}}" ><a href="ticket_start={{$value['system_id']}}">{{$value['system_name']}}</a></li>
                {{/if}}
                {{/foreach}}
                {{/if}}
            </ul>

        </div>
        <h3 class="wap-fnts-1">目的地</h3>
        <div id="brand1" class="jy-border-bd-1">
            <ul class="listnav">
                <li class="gree"><a href="#">不限</a> </li>
                {{if !empty($system)}}
                {{foreach $system as $key=>$value}}
                {{if $value['system_class']==2}}
                <li ast="{{$value['system_id']}}" ><a href="ticket_end={{$value['system_id']}}">{{$value['system_name']}}</a></li>
                {{/if}}
                {{/foreach}}
                {{/if}}
            </ul>
        </div>
        <h3 class="wap-fnts-1">出游天数</h3>
        <div id="brand2" class="jy-border-bd-1">
            <ul class="listnav">
                <li class="gree"><a href="#">不限</a> </li>
                {{if !empty($system)}}
                {{foreach $system as $key=>$value}}
                {{if $value['system_class']==3}}
                <li ast="{{$value['system_id']}}" ><a href="ticket_day={{$value['system_id']}}">{{$value['system_name']}}</a></li>
                {{/if}}
                {{/foreach}}
                {{/if}}
            </ul>
        </div>
        <h3 class="wap-fnts-1">出发时间</h3>
        <div id="brand3" class="jy-border-bd-1">
            <ul class="listnav">
                <li class="gree"><a href="#">不限</a> </li>
                {{if !empty($system)}}
                {{foreach $system as $key=>$value}}
                {{if $value['system_class']==4}}
                <li ast="{{$value['system_id']}}" ><a href="ticket_start_time={{$value['system_id']}}">{{$value['system_name']}}</a></li>
                {{/if}}
                {{/foreach}}
                {{/if}}
            </ul>
        </div>
        <h3 class="wap-fnts-1">主题路线</h3>
        <div id="brand4" class="jy-border-bd-1">
            <ul class="listnav">
                <li class="gree"><a href="#">不限</a> </li>
                {{if !empty($system)}}
                {{foreach $system as $key=>$value}}
                {{if $value['system_class']==5}}
                <li ast="{{$value['system_id']}}" ><a href="ticket_sub_line={{$value['system_id']}}">{{$value['system_name']}}</a></li>
                {{/if}}
                {{/foreach}}
                {{/if}}
            </ul>
        </div>

    </div>
</div>
<script type="text/javascript">
    var Abut=document.getElementById("check");
    var ListNavBox=document.getElementById("listnavbox");
    Abut.onclick=function(){
        if(ListNavBox.style.display=="block"){
            ListNavBox.style.display="none";
        }else{
            ListNavBox.style.display="block";
        }
    }

</script>

<!--国内旅游-->
<section id="content-box" class="wap-bg-2 wap-marg-t-1">
    <div class="text-list">
        <ul class="wap-ul-1">
            {{if !empty($ticket)}}
            {{foreach $ticket['rows'] as $key=>$value}}
            <li>
                <a href="/m/ticket/details/{{$value['ticket_id']}}.html">
                    <img src="{{$value['ticket_wap_pic1']}}" />
                    <dl class="text-dl-1 wap-pst-r">
                        <dd>{{cut_str($value['ticket_name'],30)}}</dd>
                        <dt>{{cut_str($value['ticket_spot'],30)}}</dt>
                        <label><b>{{$value['ticket_end_name']}}</b><i class="wap-fr">￥{{$value['ticket_market_price']}}<em>起/份</em></i></label>
                    </dl>
                </a>
            </li>
            {{/foreach}}
            {{/if}}
        </ul>
    </div>

</section>
<div class="clear"></div>
<div class="pagination pagination-left">
    <ul>
		<li>
			{{if $ticket['page']==0 or empty($ticket['page'])}}<span class="prev"> ← Prev</span>{{else}}<a class="prev" href="/m/ticket/page_{{max($ticket['page']-1,0)}}.html"> ← Prev</a>{{/if}}
		</li>
		{{for $o=1 to $ticket['page_all']}}
		<li>
			{{if $ticket['page']+1==$o}}<span>{{$o}}</span>{{else}}<a href="/m/ticket/page_{{$o-1}}.html">{{$o}}</a>{{/if}}
		</li>
		{{/for}}
		<li>
			{{if ($ticket['page']+1)==$ticket['page_all'] or $ticket['page_all']==0}}<span>Next → </span>{{else}}<a href="/m/ticket/page_{{min($ticket['page']+1,$ticket['page_all']-1)}}.html">Next → </a>{{/if}}
		</li>
    </ul>
</div>
<!--底部-->
{{include file='../common/footer.html'}}
<script src="/statics/pc/js/jquery-1.8.3.min.js"></script>
<script type="application/javascript">
    var ast = {
        getticket_start : null,//url中ticket_start值
        getticket_end : null,//url中ticket_end值
        getticket_day : null,//url中ticket_day值
        getticket_start_time : null,//url中ticket_start_time值
        getpticket_sub_line : null,//url中ticket_sub_line值
        domticket_start : null,
        domticket_end : null,
        domticket_day : null,
        domticket_start_time : null,
        domticket_sub_line : null,
        init : function(){
            ast.urlResolve();//获取url中五个参数

            ast.domticket_start = $('#brand li');
            ast.operateSelect(ast.domticket_start,ast.getticket_start);
            ast.operateHref(ast.domticket_start,'ticket_start');

            ast.domticket_end = $('#brand1 li');
            ast.operateSelect(ast.domticket_end,ast.getticket_end);
            ast.operateHref(ast.domticket_end,'ticket_end');

            ast.domticket_day = $('#brand2 li');
            ast.operateSelect(ast.domticket_day,ast.getticket_day);
            ast.operateHref(ast.domticket_day,'ticket_day');

            ast.domticket_start_time = $('#brand3 li');
            ast.operateSelect(ast.domticket_start_time,ast.getticket_start_time);
            ast.operateHref(ast.domticket_start_time,'ticket_start_time');

            ast.domticket_sub_line = $('#brand4 li');
            ast.operateSelect(ast.domticket_sub_line,ast.getpticket_sub_line);
            ast.operateHref(ast.domticket_sub_line,'ticket_sub_line');
        },
        urlResolve : function(){
            /*
             以?分隔符，如果返回数组长度等于2，get[1]的数据类似brand=2&grade=13&price=0-5
             再以&分隔符分隔参数，再分别用brand=、grade=、price=得到各自的url参数
             */
            get = document.location.href.split('?');
            if (get.length==2){
                gets = get[1].split('&');
                for (i=0;i<gets.length;i++){
                    tem = gets[i].split('ticket_start=');
                    if (tem.length==2){ast.getticket_start = tem[1];	continue;}
                    tem = gets[i].split('ticket_end=');
                    if (tem.length==2){ast.getticket_end = tem[1];	continue;}
                    tem = gets[i].split('ticket_day=');
                    if (tem.length==2){ast.getticket_day = tem[1];	continue;}
                    tem = gets[i].split('ticket_start_time=');
                    if (tem.length==2){ast.getticket_start_time = tem[1];	continue;}
                    tem = gets[i].split('ticket_sub_line=');
                    if (tem.length==2){ast.getpticket_sub_line = tem[1];	continue;}
                }
            }
        },
        operateSelect : function(dom,urlattr){
            /*
             如果特定url参数不为空，比如brand=2，则首先清除不限的选中样式
             再循环查找到li属性ast=urlattr，标记选中，结束循环
             */
            if (urlattr!=null){
                dom.first().removeClass('gree');
                ast._urlattr = urlattr;
                dom.each(function(){
                    if ($(this).attr('ast')==ast._urlattr){
                        $(this).addClass('gree');	return;
                    }
                });
            }
        },
        operateHref : function(dom,type){
            /*
             将三url参数保存到副本中，type枚举:'brand'、'grade'、'price'
             当type='brand'表示操作<div id="brand">，此时ast._getbrand不取url中brand值，而取<li ast="2">中ast参数
             type='grade'、type='price' 类推

             _getbrand如果为空返回‘?’，不为空返回'?brand='
             href 不等于'?'且_getgrade不为空，则需要&拼接
             最终得到相应href字符串
             */
            ast._type = type;
            dom.each(function() {
                ast._getticket_start = ast.getticket_start;
                ast._getticket_end = ast.getticket_end;
                ast._getticket_day = ast.getticket_day;
                ast._getticket_start_time = ast.getticket_start_time;
                ast._getpticket_sub_line = ast.getpticket_sub_line;

                switch (ast._type){
                    case 'ticket_start':
                        ast._getticket_start = $(this).attr('ast');	break;
                    case 'ticket_end':
                        ast._getticket_end = $(this).attr('ast');	break;
                    case 'ticket_day':
                        ast._getticket_day = $(this).attr('ast');	break;
                    case 'ticket_start_time':
                        ast._getticket_start_time = $(this).attr('ast');	break;
                    case 'ticket_sub_line':
                        ast._getpticket_sub_line = $(this).attr('ast');	break;
                }
                href = ast._getticket_start==null ? '?' : '?ticket_start=' + ast._getticket_start;
                href += ((href!='?' && ast._getticket_end!=null) ? '&' : '') + (ast._getticket_end==null ? '' : 'ticket_end=' + ast._getticket_end);
                href += ((href!='?' && ast._getticket_day!=null) ? '&' : '') + (ast._getticket_day==null ? '' : 'ticket_day=' + ast._getticket_day);
                href += ((href!='?' && ast._getticket_start_time!=null) ? '&' : '') + (ast._getticket_start_time==null ? '' : 'ticket_start_time=' + ast._getticket_start_time);
                href += ((href!='?' && ast._getpticket_sub_line!=null) ? '&' : '') + (ast._getpticket_sub_line==null ? '' : 'ticket_sub_line=' + ast._getpticket_sub_line);
                $(this).children('a').attr('href',href);
            });
        }
    }
    $(function(){
        ast.init();
    });
    $('.ticket').addClass('gree');
</script>
</body>
</html>